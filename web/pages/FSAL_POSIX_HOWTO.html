<h1>Exporting a POSIX filesystem with GANESHA</h1><br>In a POSIX filesystem, entries are accessed using their path, which does not<br>meet the requirements for a handle (persistency, unicity).<br>However GANESHA provides a FSAL that can assign a unique and persistent<br>filehandle to each filesystem entry. To do this, it needs to keep some persistent<br>information in a database.<br><br>This document will describe the database configuration needed,<br>and the parameters GANESHA uses for accessing this database.<br><br>PostgreSQL configuration<br><br>GANESHA supports both PostgreSQL versions 7 and 8.<br>This section will explain how to install/configure a PostgreSQL 8.1 database in order to use the POSIX FSAL.<br>For 7.x version, configuration is very similar (differences will be noticed inline).<br>In the following description, replace&nbsp;%DBNAME% and&nbsp;%USERNAME% signs<br>with the actual database name and user name you want to use.<br><br><ul><li>First, install the PostgreSQL 8.1 package.</li><li>Then, take the "postgres" identity (this user is created during package setup. It has all rights on PostgreSQL engine)</li><li>Create a new user for using the database with GANESHA:</li><ul><li>createuser
--no-superuser --no-createdb --no-createrole --login
--pwprompt&nbsp;%USERNAME% (you will be prompted for a password).</li></ul><li>Create a new database (owned by the user we have just created):</li><ul><li>createdb -O&nbsp;%USERNAME%&nbsp;%DBNAME%</li></ul><li>In
order to use PGSQL Procedural Language for improving frequent database
queries, we have to activate plpgsql into our database:</li><ul><li>createlang plpgsql&nbsp;%DBNAME%</li></ul><li>Make sure you have tcp connections enabled for your database. This is set in file&nbsp;<span style="font-style: italic;">postgresql.conf</span> (it should be located in <span style="font-style: italic;">/var/lib/pgsql/data</span>.&nbsp;</li></ul>&nbsp;<br><ul><li>We can now create the tables in the database. To do this, retrieve the appropriate SQL script from directory&nbsp;<span style="font-style: italic;">src/FSAL/FSAL\_POSIX/DBExt/PGSQL/posixdb_v8.sql</span> in GANESHA sources, then execute it like this:</li><ul><li>cat posixdb\_v8.sql | psql -h localhost -U&nbsp;%USERNAME%&nbsp;%DBNAME%</li></ul><li>Create a keytab file in order for GANESHA to access the database. The content of this file&nbsp; must have the following syntax:<br></li></ul><div style="margin-left: 40px;">hostname:port:database:username:password<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and \texttt{DB\_login}.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
This file's permissions MUST be 600
(rw-------).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
<br></div><br>Database is now ready.<br><br>For using GANESHA's over a POSIX filesystem, you have to build it using the configure-<span style="font-style: italic;">-with-fsal=POSIX.</span><br>It with automatically check which PostgreSQL version is installed on your system.<br><br>If your database support stored procedures (PostgreSQL PL), you can activate it with&nbsp;--enable-pl-pgsql<br><br>Thus, for compiling GANESHA execute the following commands:<br><br><div style="margin-left: 40px;">cd src<br>./configure --with-fsal=POSIX --enable-pl-pgsql<br>make<br></div><br>GANESHA configuration for FSAL/POSIX<br><br>To configure GANESHA's access to the database, you have to set<br>some options in the configuration file: this in done in the&nbsp;POSIX'<br>configuration block.<br><br>In this block, you must set the following values:<br><br><br><ul><li>DB_host: address of the host where the PostgreSQL database is running.</li><li>DB_port: port number where the PostgreSQL database engine is listening on.</li><li>DB_name: the database name.</li><li>DB_login: user owning the database.</li><li>DB_keytab: path of the keytab file.<br></li></ul><br>NB: all those values must be exactly the same as in the database keytab file.<br><br><br>Here is an example of a POSIX block in the configuration file:<br><br><div style="margin-left: 40px;">POSIX<br>{<br>&nbsp;&nbsp;&nbsp; # Host<br>&nbsp;&nbsp;&nbsp; DB_Host = "%DB_HOST%";<br><br>&nbsp;&nbsp;&nbsp; # Port<br>&nbsp;&nbsp;&nbsp; DB_Port = 5432;<br><br>&nbsp;&nbsp;&nbsp; # Database Name<br>&nbsp;&nbsp;&nbsp; DB_Name = "POSIX_FS_DB";<br><br>&nbsp;&nbsp;&nbsp; # Login<br>&nbsp;&nbsp;&nbsp; DB_Login = "GANESHA";<br><br>&nbsp;&nbsp;&nbsp; # File for the file where is stored the password<br>&nbsp;&nbsp;&nbsp; # (format of the file is Database specific)<br>&nbsp;&nbsp;&nbsp; DB_keytab = "/var/ganesha/posixdb.keytab";<br>}<br></div><br><br>
